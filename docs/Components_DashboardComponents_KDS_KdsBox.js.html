

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Harbour Bites FE documentation Components/DashboardComponents/KDS/KdsBox.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Harbour Bites FE documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/shivamsharmaexternlabs/externlabs-restaurant"
                        >
                            Respository
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"></div><div class="category"><h2>AdminProfilePage Functions</h2><h3>Global</h3><ul><li><a href="global.html#BannerImageUploadFun">BannerImageUploadFun</a></li><li><a href="global.html#LogoImageUploadFun">LogoImageUploadFun</a></li><li><a href="global.html#callBackFuncAfterSignUp">callBackFuncAfterSignUp</a></li><li><a href="global.html#handleOnChange1">handleOnChange1</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li></ul></div><div class="category"><h2>AllMedia</h2><h3>Global</h3><ul><li><a href="global.html#AllMedia">AllMedia</a></li></ul></div><div class="category"><h2>AllMedia Function</h2><h3>Global</h3><ul><li><a href="global.html#DeleteImageFun">DeleteImageFun</a></li><li><a href="global.html#MultiUploadFun">MultiUploadFun</a></li></ul></div><div class="category"><h2>App</h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li></ul></div><div class="category"><h2>Authentication</h2><h3>Global</h3><ul><li><a href="global.html#ForgotPassword">ForgotPassword</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li></ul></div><div class="category"><h2>Custom Hook</h2><h3>Global</h3><ul><li><a href="global.html#useDownloadQr">useDownloadQr</a></li><li><a href="global.html#useLogoutHook">useLogoutHook</a></li><li><a href="global.html#usePopUpHook">usePopUpHook</a></li></ul></div><div class="category"><h2>Dashboard</h2><h3>Global</h3><ul><li><a href="global.html#CategoryTabFun">CategoryTabFun</a></li><li><a href="global.html#Dashboard">Dashboard</a></li><li><a href="global.html#QrCodeDownloadFun">QrCodeDownloadFun</a></li><li><a href="global.html#i18n-LanguageChange">i18n-LanguageChange</a></li><li><a href="global.html#useEffect">useEffect</a></li></ul></div><div class="category"><h2>Dashboard Component</h2><h3>Global</h3><ul><li><a href="global.html#AdminProfilePage">AdminProfilePage</a></li><li><a href="global.html#DndCategories">DndCategories</a></li></ul></div><div class="category"><h2>DndCategories function</h2><h3>Global</h3><ul><li><a href="global.html#handleDndUpdate">handleDndUpdate</a></li><li><a href="global.html#handleDragOver">handleDragOver</a></li><li><a href="global.html#handleDrop">handleDrop</a></li><li><a href="global.html#startDrag">startDrag</a></li></ul></div><div class="category"><h2>KDS</h2><h3>Global</h3><ul><li><a href="global.html#KdsBox">KdsBox</a></li><li><a href="global.html#KdsScreen">KdsScreen</a></li></ul></div><div class="category"><h2>KdsBox Functions</h2><h3>Global</h3><ul><li><a href="global.html#handleConfirmation">handleConfirmation</a></li><li><a href="global.html#handleStartCooking">handleStartCooking</a></li><li><a href="global.html#processKdsData">processKdsData</a></li></ul></div><div class="category"><h2>KdsScreen function</h2><h3>Global</h3><ul><li><a href="global.html#handleLogout">handleLogout</a></li></ul></div><div class="category"><h2>Login</h2><h3>Global</h3><ul><li><a href="global.html#Login">Login</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#languageSwitchFun">languageSwitchFun</a></li><li><a href="global.html#useEffect">useEffect</a></li></ul></div><div class="category"><h2>i18n</h2><h3>Global</h3><ul><li><a href="global.html#middleware">middleware</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>Components/DashboardComponents/KDS/KdsBox.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from 'react'
import './kdsScreen.css'
import foodparcel from '../../../images/food-parcel.svg'
import cooking from '../../../images/cooking.svg'
import DineIn from '../../../images/plate.svg'
import takeAwayVerified from '../../../images/take-away-verified.svg'
import DineInVerified from '../../../images/dineInVerified.svg'
import PopUpComponent from '../../../ReusableComponents/PopUpComponent/PopUpComponent'
import markAsDone from '../../../images/mark-as-done.svg'
import { useSelector, useDispatch } from 'react-redux';
import { GetKdsSlice, UpdateKdsSlice } from '../../../Redux/slices/KdsSlice'


/**
* KdsBox component displays kitchen display system (KDS) information.
* @returns {JSX.Element} KdsBox component JSX
*  @category KDS
*/
function KdsBox() {
  /**
   * State to hold KDS data.
   * @type {Array&lt;object>}
   */

  const dispatch = useDispatch();
  const language = localStorage.getItem('languageSet');
  const { GetKdsReducerData } = useSelector((state) => state.KdsApiData);
  const restaurant_id = localStorage.getItem('RestaurantId');
  const token = localStorage.getItem('Token');

  const [showConfirmation, setShowConfirmation] = useState(false);
  const [currentOrder, setCurrentOrder] = useState(null);

  /**
   * Handles current order status data .
   * @function processKdsData
   * @param {Array} kdsData - kdsData is an array of objects.
   * @category KdsBox Functions
   * @subCategory Dashboard Component
   */

  function processKdsData(kdsData) {
    let dineIn = [];
    let takeAway = [];

    if (kdsData &amp;&amp; kdsData.data) {
      for (let i = 0; i &lt; kdsData.data.length; i++) {
        dineIn.push({
          tableName: kdsData.data[i].kds[0].restaurant_table.table_number,
          tableId: kdsData.data[i].kds[0].restaurant_table.table_id,
          items: [],
        });
        takeAway.push({
          tableName: kdsData.data[i].kds[0].restaurant_table.table_number,
          tableId: kdsData.data[i].kds[0].restaurant_table.table_id,
          items: [],
        });
      }

      for (let table of kdsData.data) {
        for (let item of table.kds) {
          dineIn.forEach((insideTable) => {
            if (
              item.restaurant_table.table_number === insideTable.tableName &amp;&amp;
              item.order_type === "dine_in"
            ) {
              insideTable.items.push(item);
            }
          });
          takeAway.forEach((insideTable) => {
            if (
              item.restaurant_table.table_number === insideTable.tableName &amp;&amp;
              item.order_type === "take_away"
            ) {
              insideTable.items.push(item);
            }
          });
        }
      }
    } else {
      console.warn("KDS data is undefined or null");
    }

    return dineIn.concat(takeAway);
  }

  // Usage example:
  const data = processKdsData(GetKdsReducerData);
  console.log("data", data);



  /**
   * Handles current order status data .
   * @function handleStartCooking
   * @param {number} itemIndex - itemIndex contain index.
   * @param {number} orderIndex - orderIndex contain index.
   * @param {object} order - order contain data.
   * @category KdsBox Functions
   * @subCategory Dashboard Component
   */
  const handleStartCooking = (itemIndex, orderIndex, order) => {
    let kot_id = order?.kot_id
    setCurrentOrder({ itemIndex, orderIndex, kot_id });
    setShowConfirmation(true);
  };


  /**
  * Handles status confirmation .
  * @function handleConfirmation
  * @param {boolean} confirmed - parms contain confirmed for confirming the order status .
  * @category KdsBox Functions
  * @subCategory Dashboard Component
  */

  const handleConfirmation = async (confirmed) => {
    if (confirmed &amp;&amp; currentOrder &amp;&amp; GetKdsReducerData &amp;&amp; GetKdsReducerData.data) {
      const { itemIndex, orderIndex, kot_id } = currentOrder;
      const currentStatus = data[itemIndex].items[orderIndex].status;
      let newStatus = "";

      if (currentStatus === "kot_generated") {
        newStatus = "start_cooking";
      } else if (currentStatus === "start_cooking") {
        newStatus = "done";
      }

      if (newStatus) {
        const updateKdsResponseData = await dispatch(
          UpdateKdsSlice({ kot_id: kot_id, status: newStatus, token: token })
        );
        if (updateKdsResponseData.payload.status === 200) {
          dispatch(GetKdsSlice({ restaurant_id: restaurant_id, token: token }));
        }
      }
    }
    setShowConfirmation(false);
  };



  useEffect(() => {
    if (!restaurant_id) {
      console.warn("Restaurant ID not found in local storage.")
    } else {
      // setInterval(()=>{
      dispatch(GetKdsSlice({ restaurant_id: restaurant_id, token: token }))
      // },3000)     
    }
  }, [])


  return (
    &lt;div>
      &lt;div className='kgcardpart'>
        {data?.map((item, index) => {

          if (item.items.length === 0) return null;

          return &lt;div className='kgcardbox' key={index}>
            &lt;div className='kgcardtitle'
              style={{ backgroundColor: item?.items[0]?.order_type === "take_away" ? "#eabb36 " : "#42B856" }}
            >
              &lt;div className='leftpart'>
                &lt;h3>
                  {item?.items[0]?.restaurant_table?.category}
                &lt;/h3>
                &lt;h4>{""}&lt;/h4>
              &lt;/div>
              &lt;div className='rightpart'>
                &lt;h2>{language === 'en' ? "Table No." : "رقم الجدول"}
                  {item.tableName}
                &lt;/h2>
              &lt;/div>
            &lt;/div>
            &lt;div className='deliveryinfo'
              style={{ backgroundColor: item?.items[0]?.order_type === 'take_away' ? "rgb(234 187 54 / 10%)" : "rgb(117 234 54 / 10%)" }}
            >
              &lt;h3  >&lt;img
                src={item?.items[0]?.order_type === 'take_away' ? foodparcel : DineIn}
                alt='parcel' />
                {item?.items[0]?.order_type === 'take_away' ?
                  (language === 'en' ? "Take Away" : "يبعد") :
                  (language === 'en' ? "Dine In" : "تناول الطعام في")}
              &lt;/h3>
              &lt;h4>{""}&lt;/h4>
            &lt;/div>
            &lt;ul className='kgcardlist'>
              {item?.items?.map((order, orderIndex) => {
                return (
                  &lt;li key={orderIndex}>
                    &lt;div className='leftpart'>
                      &lt;h3 style={{ textDecoration: order.status === 'done' ? "line-through" : "none" }}>
                        {order.quantity} x {language === 'en' ? order.item.item_name_en : order.item.item_name_native}
                      &lt;/h3>
                      &lt;p style={{ textDecoration: order.status === 'done' ? "line-through" : "none", color: "#998888" }}>
                        {language === 'en' ? order.variant.variant_name_en : order.variant.variant_name_native}
                      &lt;/p>
                    &lt;/div>
                    &lt;div className='rightpart'>
                      {order.status === 'done' ? "" :
                        &lt;button
                          type="button"
                          style={{
                            borderColor: order.order_type === "take_away" ? "#eabb36" : "#42B856",
                            color: order.order_type === "take_away" ? "#eabb36" : "#42B856",
                          }}
                          onClick={() => handleStartCooking(index, orderIndex, order)}
                        >
                          {(order.status === "kot_generated") ?
                            (language === "en" ? "Start Cooking" : "ابدأ الطهي") :
                            (language === "en" ? "Mark as done" : "اعتبره منته")}
                          &lt;img
                            src={
                              order.status === "start_cooking"
                                ? order.order_type === "take_away"
                                  ? takeAwayVerified
                                  : DineInVerified
                                : cooking
                            }
                            alt="img"
                          />
                        &lt;/button>
                      }
                    &lt;/div>
                  &lt;/li>
                );
              })}
            &lt;/ul>

          &lt;/div>


        })
        }



      &lt;/div>
      {showConfirmation &amp;&amp; (
        &lt;PopUpComponent classNameValue={"kds-popup"}>
          &lt;div className="popupbody">
            &lt;img
              src={
                currentOrder &amp;&amp;
                  data[currentOrder.itemIndex].items[currentOrder.orderIndex]
                    .status === "kot_generated"
                  ? cooking
                  : markAsDone
              }
              alt='Cooking pan'
              height={markAsDone ? "80px" : "100px"}
              width={"100px"}
            />
            &lt;h2 className='popup-head'>
              {language === "en"
                ? currentOrder &amp;&amp;
                  data[currentOrder.itemIndex].items[currentOrder.orderIndex]
                    .status === "kot_generated"
                  ? "Are you sure?"
                  : "Do you want to \n Mark it as Done?"
                : currentOrder &amp;&amp;
                  data[currentOrder.itemIndex].items[currentOrder.orderIndex]
                    .status === "kot_generated"
                  ? "هل أنت متأكد؟"
                  : "هل تريد وضع علامةعليه؟"}
            &lt;/h2>

            &lt;p className='popup-para'>
              {language === "en"
                ? currentOrder &amp;&amp;
                  data[currentOrder.itemIndex].items[currentOrder.orderIndex]
                    .status === "kot_generated"
                  ? "You are starting Cooking"
                  : ""
                : currentOrder &amp;&amp;
                  data[currentOrder.itemIndex].items[currentOrder.orderIndex]
                    .status === "kot_generated"
                  ? "أنت بصدد بدء الطهي"
                  : ""}
            &lt;/p>

            &lt;div className="popup-btn">
              &lt;button onClick={() => setShowConfirmation(false)} className='popup-cal-btn'>  {language === "en" ? "Cancel" : "يلغي"}&lt;/button>
              &lt;button
                onClick={() => {
                  handleConfirmation(true);
                  setShowConfirmation(false);
                }}
                style={{ backgroundColor: "#EA6A12" }}
                className='popup-yes-btn'
              >
                {language === "en" ? "Yes" : "نعم"}
              &lt;/button>
            &lt;/div>
          &lt;/div>
        &lt;/PopUpComponent>
      )}

    &lt;/div>
  )
}

export default KdsBox
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
